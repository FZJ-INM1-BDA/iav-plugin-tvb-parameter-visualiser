var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function a(e){e.forEach(t)}function l(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t){e.appendChild(t)}function r(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode.removeChild(e)}function o(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function u(){return d(" ")}function f(){return d("")}function m(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function p(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function g(e,t){t=""+t,e.data!==t&&(e.data=t)}let h;function _(e){h=e}function v(){if(!h)throw new Error("Function called outside component initialization");return h}function $(e){v().$$.on_mount.push(e)}function b(){const e=v();return(t,n)=>{const a=e.$$.callbacks[t];if(a){const l=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);a.slice().forEach(t=>{t.call(e,l)})}}}const x=[],y=[],w=[],L=[],E=Promise.resolve();let k=!1;function N(e){w.push(e)}let A=!1;const F=new Set;function V(){if(!A){A=!0;do{for(let e=0;e<x.length;e+=1){const t=x[e];_(t),C(t.$$)}for(x.length=0;y.length;)y.pop()();for(let e=0;e<w.length;e+=1){const t=w[e];F.has(t)||(F.add(t),t())}w.length=0}while(x.length);for(;L.length;)L.pop()();k=!1,A=!1,F.clear()}}function C(e){if(null!==e.fragment){e.update(),a(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(N)}}const I=new Set;function D(e,t){e&&e.i&&(I.delete(e),e.i(t))}function P(e,t,n,a){if(e&&e.o){if(I.has(e))return;I.add(e),(void 0).c.push(()=>{I.delete(e),a&&(n&&e.d(1),a())}),e.o(t)}}function H(e){e&&e.c()}function M(e,n,s){const{fragment:i,on_mount:r,on_destroy:c,after_update:o}=e.$$;i&&i.m(n,s),N(()=>{const n=r.map(t).filter(l);c?c.push(...n):a(n),e.$$.on_mount=[]}),o.forEach(N)}function T(e,t){const n=e.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function S(e,t){-1===e.$$.dirty[0]&&(x.push(e),k||(k=!0,E.then(V)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function j(t,l,s,i,r,o,d=[-1]){const u=h;_(t);const f=l.props||{},m=t.$$={fragment:null,ctx:null,props:o,update:e,not_equal:r,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:n(),dirty:d};let p=!1;if(m.ctx=s?s(t,f,(e,n,...a)=>{const l=a.length?a[0]:n;return m.ctx&&r(m.ctx[e],m.ctx[e]=l)&&(m.bound[e]&&m.bound[e](l),p&&S(t,e)),n}):[],m.update(),p=!0,a(m.before_update),m.fragment=!!i&&i(m.ctx),l.target){if(l.hydrate){const e=function(e){return Array.from(e.childNodes)}(l.target);m.fragment&&m.fragment.l(e),e.forEach(c)}else m.fragment&&m.fragment.c();l.intro&&D(t.$$.fragment),M(t,l.target,l.anchor),V()}_(u)}class O{$destroy(){T(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function U(e,t,n){const a=e.slice();return a[5]=t[n],a}function z(e){let t,n,a;return{c(){t=o("option"),n=d(e[2]),a=u(),t.__value=e[2],t.value=t.__value},m(e,l){r(e,t,l),i(t,n),i(t,a)},p(e,a){4&a&&g(n,e[2]),4&a&&(t.__value=e[2]),t.value=t.__value},d(e){e&&c(t)}}}function G(e){let t,n,a,l,s=e[5]+"";return{c(){t=o("option"),n=d(s),a=u(),t.__value=l=e[5],t.value=t.__value},m(e,l){r(e,t,l),i(t,n),i(t,a)},p(e,a){1&a&&s!==(s=e[5]+"")&&g(n,s),1&a&&l!==(l=e[5])&&(t.__value=l),t.value=t.__value},d(e){e&&c(t)}}}function B(t){let n,a,l,s,d,u=t[2]&&z(t),p=t[0],g=[];for(let e=0;e<p.length;e+=1)g[e]=G(U(t,p,e));return{c(){n=o("select"),a=o("option"),a.textContent="-- select --\n  ",u&&u.c(),l=f();for(let e=0;e<g.length;e+=1)g[e].c();a.__value="null",a.value=a.__value,a.disabled=!0,n.disabled=t[1]},m(e,c,o){r(e,n,c),i(n,a),u&&u.m(n,null),i(n,l);for(let e=0;e<g.length;e+=1)g[e].m(n,null);s=t[2]||"null";for(var f=0;f<n.options.length;f+=1){var p=n.options[f];if(p.__value===s){p.selected=!0;break}}o&&d(),d=m(n,"change",t[3])},p(e,[t]){if(e[2]?u?u.p(e,t):(u=z(e),u.c(),u.m(n,l)):u&&(u.d(1),u=null),1&t){let a;for(p=e[0],a=0;a<p.length;a+=1){const l=U(e,p,a);g[a]?g[a].p(l,t):(g[a]=G(l),g[a].c(),g[a].m(n,null))}for(;a<g.length;a+=1)g[a].d(1);g.length=p.length}if(4&t&&s!==(s=e[2]||"null"))for(var a=0;a<n.options.length;a+=1){var i=n.options[a];if(i.__value===s){i.selected=!0;break}}2&t&&(n.disabled=e[1])},i:e,o:e,d(e){e&&c(n),u&&u.d(),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(g,e),d()}}}function K(e,t,n){let{inputList:a}=t,{disabled:l}=t,{selectedVal:s}=t;const i=b();return e.$set=e=>{"inputList"in e&&n(0,a=e.inputList),"disabled"in e&&n(1,l=e.disabled),"selectedVal"in e&&n(2,s=e.selectedVal)},[a,l,s,function(e){const t=e.srcElement.value;i("selectChanged",{value:t})}]}class R extends O{constructor(e){super(),j(this,e,K,B,s,{inputList:0,disabled:1,selectedVal:2})}}function W(t){let n;return{c(){n=o("div"),n.textContent="No data to display"},m(e,t){r(e,n,t)},p:e,d(e){e&&c(n)}}}function q(t){let n;return{c(){n=o("div"),p(n,"class","graph-container svelte-rklmzr")},m(e,a){r(e,n,a),t[4](n)},p:e,d(e){e&&c(n),t[4](null)}}}function J(t){let n;function a(e,t){return e[0]?q:W}let l=a(t),s=l(t);return{c(){s.c(),n=f()},m(e,t){s.m(e,t),r(e,n,t)},p(e,[t]){l===(l=a(e))&&s?s.p(e,t):(s.d(1),s=l(e),s&&(s.c(),s.m(n.parentNode,n)))},i:e,o:e,d(e){s.d(e),e&&c(n)}}}function Q(e,t,n){let a,l,{data:s}=t;const i={left:40,top:0,right:10,bottom:20};var r;return r=()=>{if(s&&a){for(;a.children[0];)a.removeChild(a.children[0]);const{left:e,right:t,top:n,bottom:l}=i,r=a.clientWidth-e-t,c=a.clientHeight-n-l,o=d3.scaleLinear().range([0,r]),d=d3.scaleLinear().range([0,c]),u=d3.line().x(e=>o(e.x)).y(e=>d(e.y)),f=d3.select(a).append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform",`translate(${e}, ${n})`);o.domain([0,s.length]),d.domain(d3.extent(s)),f.append("path").attr("fill","none").attr("stroke-width","1px").attr("stroke","steelblue").data([s.map((e,t)=>({x:t,y:e}))]).attr("d",u),f.append("g").attr("transform",`translate(0, ${c})`).call(d3.axisBottom(o)),f.append("g").call(d3.axisLeft(d))}},v().$$.before_update.push(r),$(()=>(console.log("mounting graph.svelte"),l=interactiveViewer.pluginControl.loadExternalLibraries(["d3@5.7.0"]),()=>{console.log("unmounting graph.svelte"),interactiveViewer.pluginControl.unloadExternalLibraries(["d3@5.7.0"])})),e.$set=e=>{"data"in e&&n(0,s=e.data)},[s,a,l,i,function(e){y[e?"unshift":"push"](()=>{n(1,a=e)})}]}class X extends O{constructor(e){var t;super(),document.getElementById("svelte-rklmzr-style")||((t=o("style")).id="svelte-rklmzr-style",t.textContent=".graph-container.svelte-rklmzr{height:20rem}",i(document.head,t)),j(this,e,Q,J,s,{data:0})}}function Y(t){let n,a;return{c(){n=o("div"),n.innerHTML='<i class="fas fa-thumbtack"></i> \n    <span>\n      Pin (alt/option + w)\n    </span>',p(n,"class","mt-2 btn btn-dark")},m(e,l,s){r(e,n,l),s&&a(),a=m(n,"click",t[10])},p:e,d(e){e&&c(n),a()}}}function Z(e){let t,n,a,l,s,d,f,g,h,_,v,$,b,x,y,w,L,E,k;const N=new R({props:{inputList:e[0],disabled:e[6],selectedVal:e[1]}});N.$on("selectChanged",e[7]);const A=new R({props:{inputList:e[2],disabled:e[6]||!e[1],selectedVal:e[3]}});A.$on("selectChanged",e[8]);const F=new R({props:{inputList:e[4].map(ee),disabled:e[6]||!e[3],selectedVal:e[5]}});F.$on("selectChanged",e[9]);let V=!e[6]&&e[4][e[5]]&&Y(e);const C=new X({props:{data:e[4][e[5]]}});return{c(){t=o("div"),n=o("div"),a=o("label"),a.textContent="Select dataset",l=u(),H(N.$$.fragment),s=u(),d=o("div"),f=o("label"),f.textContent="Select file",g=u(),H(A.$$.fragment),_=u(),v=o("div"),$=o("label"),$.textContent="Select index",b=u(),H(F.$$.fragment),y=u(),V&&V.c(),w=u(),L=o("div"),H(C.$$.fragment),p(a,"class","d-inline-block"),p(n,"class","d-flex flex-column"),p(f,"class","d-inline-block"),p(d,"class",h="d-flex flex-column pt-2 "+(e[1]?"":"tvb-plugin-muted")+" svelte-1mng8sy"),p($,"class","d-inline-block"),p(v,"class",x="d-flex flex-column pt-2 "+(e[1]&&e[3]?"":"tvb-plugin-muted")+" svelte-1mng8sy"),p(L,"class","d-flex flex-column pt-2"),p(t,"class","d-flex flex-column m-2")},m(c,o,u){r(c,t,o),i(t,n),i(n,a),i(n,l),M(N,n,null),i(t,s),i(t,d),i(d,f),i(d,g),M(A,d,null),i(t,_),i(t,v),i(v,$),i(v,b),M(F,v,null),i(t,y),V&&V.m(t,null),i(t,w),i(t,L),M(C,L,null),E=!0,u&&k(),k=m(window,"keydown",e[13])},p(e,[n]){const a={};1&n&&(a.inputList=e[0]),64&n&&(a.disabled=e[6]),2&n&&(a.selectedVal=e[1]),N.$set(a);const l={};4&n&&(l.inputList=e[2]),66&n&&(l.disabled=e[6]||!e[1]),8&n&&(l.selectedVal=e[3]),A.$set(l),(!E||2&n&&h!==(h="d-flex flex-column pt-2 "+(e[1]?"":"tvb-plugin-muted")+" svelte-1mng8sy"))&&p(d,"class",h);const s={};16&n&&(s.inputList=e[4].map(ee)),72&n&&(s.disabled=e[6]||!e[3]),32&n&&(s.selectedVal=e[5]),F.$set(s),(!E||10&n&&x!==(x="d-flex flex-column pt-2 "+(e[1]&&e[3]?"":"tvb-plugin-muted")+" svelte-1mng8sy"))&&p(v,"class",x),!e[6]&&e[4][e[5]]?V?V.p(e,n):(V=Y(e),V.c(),V.m(t,w)):V&&(V.d(1),V=null);const i={};48&n&&(i.data=e[4][e[5]]),C.$set(i)},i(e){E||(D(N.$$.fragment,e),D(A.$$.fragment,e),D(F.$$.fragment,e),D(C.$$.fragment,e),E=!0)},o(e){P(N.$$.fragment,e),P(A.$$.fragment,e),P(F.$$.fragment,e),P(C.$$.fragment,e),E=!1},d(e){e&&c(t),T(N),T(A),T(F),V&&V.d(),T(C),k()}}}const ee=(e,t)=>t;function te(e,t,n){let{datasetArray:a=[]}=t,{selectedDataset:l=null}=t,{fetchedFiles:s=[]}=t,{selectedFile:i=null}=t,{fetchedDataFromFile:r=[]}=t,{staticFlag:c}=t,{selectedTrackIndex:o}=t;const d=()=>{n(0,a=[]),n(1,l=null),fetch(`${__HOSTNAME__}/data/`).then(e=>e.json()).then(e=>{n(0,a=e)})};function u(){n(2,s=[]),n(3,i=null);const e=new URL(`${__HOSTNAME__}/data/get_filtered_filenames`);e.searchParams.set("kgDatasetId",l),fetch(e).then(e=>e.json()).then(e=>{n(2,s=e.map(({name:e})=>e))})}function f(){const e=new URL(`${__HOSTNAME__}/frontend/manifest.json`);e.searchParams.set("selectedDataset",l),e.searchParams.set("selectedFile",i),e.searchParams.set("selectedTrackIndex",o),fetch(e).then(e=>e.json()).then(e=>{interactiveViewer.uiHandle.launchNewWidget(e)})}$(()=>{const e=[];if(c){if(i&&l){const e=new URL(`${__HOSTNAME__}/data/get_matrix`);e.searchParams.set("filename",i),e.searchParams.set("kgDatasetId",l),fetch(e).then(e=>e.json()).then(e=>{n(4,r=e)})}}else{d(),interactiveViewer.viewerHandle.setLayerVisibility({name:/jubrain/},!1);const t={};t[`${__PLUGIN_NAME__}-DK68`]={type:"segmentation",source:`nifti://${__HOSTNAME__}/data/public/aparcaseg.nii.gz`,selectedOpacity:.5},interactiveViewer.viewerHandle.loadLayer(t),e.push(interactiveViewer.viewerHandle.mouseOverNehubaLayers.subscribe(e=>{if(n(5,o=null),e){const t=e.find(({layer:e})=>e.name===`${__PLUGIN_NAME__}-DK68`);if(t){const e=/#([0-9]{1,})$/.exec(t.segment);e&&n(5,o=Number(e[1]))}}}))}return()=>{for(c||(interactiveViewer.viewerHandle.setLayerVisibility({name:/jubrain/},!0),interactiveViewer.viewerHandle.removeLayer({name:`${__PLUGIN_NAME__}-DK68`}));e.length>0;)e.pop().unsubscribe()}});return e.$set=e=>{"datasetArray"in e&&n(0,a=e.datasetArray),"selectedDataset"in e&&n(1,l=e.selectedDataset),"fetchedFiles"in e&&n(2,s=e.fetchedFiles),"selectedFile"in e&&n(3,i=e.selectedFile),"fetchedDataFromFile"in e&&n(4,r=e.fetchedDataFromFile),"staticFlag"in e&&n(6,c=e.staticFlag),"selectedTrackIndex"in e&&n(5,o=e.selectedTrackIndex)},[a,l,s,i,r,o,c,function(e){n(1,l=e.detail.value),u()},function(e){n(4,r=[]),n(3,i=e.detail.value);const t=new URL(`${__HOSTNAME__}/data/get_matrix`);t.searchParams.set("filename",i),t.searchParams.set("kgDatasetId",l),fetch(t).then(e=>e.json()).then(e=>{n(4,r=e)})},function(e){const t=e.detail.value;n(5,o=Number(t))},f,d,u,e=>!c&&"KeyW"===e.code&&e.altKey&&f()]}const ne=document.getElementById(`${__PLUGIN_NAME__}.container`),ae=ne.getAttribute("static-flag"),le=ne.getAttribute("selected-file"),se=ne.getAttribute("selected-dataset"),ie=ne.getAttribute("selected-track-index"),re=new class extends O{constructor(e){var t;super(),document.getElementById("svelte-1mng8sy-style")||((t=o("style")).id="svelte-1mng8sy-style",t.textContent=".tvb-plugin-muted.svelte-1mng8sy{opacity:0.5}",i(document.head,t)),j(this,e,te,Z,s,{datasetArray:0,selectedDataset:1,fetchedFiles:2,selectedFile:3,fetchedDataFromFile:4,staticFlag:6,selectedTrackIndex:5})}}({target:ne,props:{staticFlag:ae,selectedFile:le,selectedDataset:se,selectedTrackIndex:ie}});return interactiveViewer.pluginControl[__PLUGIN_NAME__].onShutdown(()=>{console.log(`onShutdown ${__PLUGIN_NAME__}`),re.$destroy()}),re}();
//# sourceMappingURL=script.js.map
